<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

    <script type="importmap">
    {
      "imports": {
        "vue": "https://unpkg.com/vue@3.4.32/dist/vue.esm-browser.js"
      },
      "scopes": {}
    }
  </script>
    <style>
        b {
            text-decoration: underline;
            padding: 0 3 0 3;
        }
    </style>
</head>

<body onload="document.getElementsByTagName('input')[0].focus()">

    <div id="app" class="container">
        <h3>Tax deferred accounts calculator</h3>
        <hr />
        <div class="row">
            <div class="col-4">
                <label for="txtAge">Age:</label>
                <input id="txtAge" class="form-control" v-model="person.age" step="1" type="number"
                    @change="calculate" />
            </div>
            <div class="col-4">
                <label for="txtRetireAge">Retirement Age:</label>
                <input id="person.retirementAge" class="form-control" v-model="person.retirementAge" step="1"
                    type="number" @change="calculate" />
            </div>
            <div class="col-4">
                <label for="txtYears">Retire in years:</label>
                <input id="txtYears" class="form-control" v-model="person.retireInYears" type="number" disabled />
            </div>
            <div class="col-4">
                <label for="txtPretaxAmount">Current Tax Deferred Savings:
                    {{toDollar(person.pretaxAmount)}}</label>
                <input id="txtPretaxAmount" class="form-control" v-model="person.pretaxAmount" step="100" type="number"
                    @change="calculate" />
            </div>
            <div class="col-4">
                <label for="person.salary">Current Salary: {{toDollar(person.salary)}}</label>
                <input id="person.salary" class="form-control" v-model="person.salary" type="number" min="0" step="1000"
                    @change="calculate" />
            </div>
            <div class="col-4">
                <label for="txtRate">Annual Return: {{toPercent(rate)}}</label>
                <input id="txtRate" class="form-control" v-model="rate" type="number" min="1" step="0.1"
                    @change="calculate" />
            </div>

        </div>

        <hr />
        <p>
        <h5>Retirement</h5>
        You are <b>{{person.age}}</b> years old, your current tax deferred retirement accounts have
        <b>{{toDollar(person.pretaxAmount)}}</b> total,
        you are planning to retire in <b>{{person.retirementAge-person.age}}</b> years in
        <b>{{person.retirementYear}}</b> at the age of
        <b>{{person.retirementAge}}</b>.
        <br />
        </p>
        <h5>Salary and 401K</h5>
        Your current salary is <b>{{toDollar(person.salary)}}</b>, you are contributing
        <b>{{toPercent(contrib.employeePercent)}}</b> percent of your
        salary to 401k, and your employer contributes <b>{{toPercent(contrib.employerPercent)}}</b> of your
        <b>{{toPercent(contrib.employeePercent)}}</b> contribution, total
        contribution is <b>{{toPercent(contrib.total)}}</b> of your
        salary each year.
        <br />
        Based on <b>{{toPercent(rate)}}</b> annual return rate, and <b>{{toPercent(contrib.total)}}</b> yearly
        contribution from employment,
        when you retire, you'll have <b>{{toDollar(result)}}</b> in your tax deferred accounts.
        <br />
        When you reach age <b>{{rmd.age}}</b>, you'll be required to take "Required Minimum Distribution" from your
        tax
        deferred accounts.
        <br />
        Assuming that you don't take any money until you are <b>{{rmd.age}}</b>, your tax deferred accounts will
        grow to
        <b>{{toDollar(rmd.startAmount)}}</b>,
        you'll be required to take out <b>_{{toDollar(rmd.startAmount)}}_</b> / 28 = <b>_{{toDollar(rmd.startAmount
            / 28)}}_</b> each year, it'll be subject to higher tax bracket of <b>___</b>%.



        </p>
    </div>
</body>

<script type="module">
    import { createApp } from "vue";
    createApp({
        data() {
            return {
                result: 0,
                rate: 7,
                inflation: 3.0,
                rmd: { age: 72, startAmount: 0 },
                contrib: { employeePercent: 6, employerPercent: 50, total: 9 },
                person: { age: 50, retirementAge: 55, retireInYears: 5, pretaxAmount: 1000000, salary: 200000 }
            }
        },

        methods: {
            calculate() {
                this.result = this.calculateCompound(
                    this.person.pretaxAmount,
                    this.rate,
                    this.person.retireInYears,
                    this.person.salary * this.contrib.total / 100
                );
                this.person.retireInYears = this.person.retirementAge - this.person.age;
                this.person.retirementYear = this.person.retireInYears + (new Date()).getFullYear();
                this.contrib.total = this.contrib.employeePercent * (1 + this.contrib.employerPercent / 100);
                this.rmd.startAmount = this.calculateCompound(this.result, this.rate, this.rmd.age - this.person.retirementAge)
            },
            calculateCompound(val, rate, years, extraContrib = 0) {
                for (let i = 0; i < years; i++) {
                    val = val * (1 + rate / 100) + extraContrib;
                }
                return val;
            },
            // Util functions
            toDollar(val) {
                return new Intl.NumberFormat("en-US", {
                    style: "currency",
                    currency: "USD",
                }).format(val);
            },
            toPercent(val) {
                return new Intl.NumberFormat("en-US", {
                    style: "percent",
                    maximumFractionDigits: 1,
                }).format(val / 100);
            },



        },
        beforeMount() {

            this.calculate();
        }
    }).mount("#app");
</script>